{% extends "base.html" %}
{% block title %}Expenses{% endblock %}

{% block content %}
  <div class="card">
    <p>{{ filters_text }}</p>

    <h2 style="margin-top:0;">Filters</h2>
    <form method="get" action="{{ url_for('index') }}">
      <div class="row">
        <label>
          Category:
          <select name="category">
            <option value="">All</option>
            {% for c in categories %}
              {% set cat = c["category"] %}
              <option value="{{ cat }}" {% if cat == selected_category %}selected{% endif %}>
                {{ cat }}
              </option>
            {% endfor %}
          </select>
        </label>

        <label>
          Month:
          <select name="month">
            <option value="">All</option>
            {% for m in months %}
              <option value="{{ m }}" {% if m == selected_month %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
          </select>
        </label>

        <button class="btn" type="submit">Apply</button>
        <a class="btn secondary" href="{{ url_for('index') }}">Clear</a>

        <a class="btn"
           href="{{ url_for('export_csv', category=selected_category, month=selected_month) }}">
          Export CSV
        </a>

        <a class="btn secondary" href="{{ url_for('stats', category=selected_category, month=selected_month) }}">
          View analytics
        </a>
      </div>
    </form>
  </div>

  <div class="card">
    <h2 style="margin-top:0;">Total: £{{ "%.2f"|format(total) }}</h2>

    {% if expenses|length == 0 %}
      <p>No expenses yet.</p>
    {% else %}
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Description</th>
            <th class="right">Amount</th>
            <th class="right">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for e in expenses %}
            <tr>
              <td>{{ e["created_at"] }}</td>
              <td>{{ e["category"] }}</td>
              <td>{{ e["description"] }}</td>
              <td class="right">£{{ "%.2f"|format(e["amount"]) }}</td>
              <td class="right">
                <a href="{{ url_for('edit_page', expense_id=e['id']) }}">Edit</a>
                <form class="inline" method="post" action="{{ url_for('delete_expense', expense_id=e['id']) }}">
                  <button class="link" type="submit" onclick="return confirm('Delete this expense?')">Delete</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% endif %}
  </div>
{% endblock %}
